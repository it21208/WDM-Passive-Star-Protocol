#### Implementation of the WDM Passive Star Network Protocol

    1. Εισαγωγή Βιβλιοθηκών Δήλωση και Αρχικοποίηση των Global Variables και Data Structures 

Το python script της εργασίας αρχίζει με την εισαγωγή της βιβλιοθήκης random που παρέχει πρόσβαση σε πολλές λειτουργίες. Στο συγκεκριμένο script η βιβλιοθήκη θα αξιοποιηθεί για την δημιουργία τυχαίων αριθμών σε καθορισμένα εύροι τιμών. Έπειτα, ακολουθεί η δήλωση και αρχικοποίηση 9 global μεταβλητών. Οι 9 global μεταβλητές διαφόρων τύπων που αφορούν α) τον αριθμό εκτέλεσης προσομοιώσεων (Runs), β) την πιθανότητα δημιουργίας πακέτων που θα χρησιμοποιηθεί για την δημιουργία του ομογενούς συστήματος (prob), γ) τον αριθμό των καναλιών (W) του channel access protocol, δ) τον αριθμό των διασυνδεδεμένων κόμβων (N), ε) τον αριθμό των χρονοθυρίδων σταθερού μεγέθους για κάθε προσομοίωση (NO_OF_SLOTS) ζ) την μέγιστη χωρητικότητα του buffer (QUEUE_SIZE) των πακέτων Li κάθε κόμβου Node i, η) τον χρονομετρητή (slot) για τις χρονοθυρίδες, θ) τον μετρητή για την δημιουργία των δημιουργηθέντων πακέτων (noOfPacketsGenerated) και ι) την boolean μεταβλητή (debug) για τον εντοπισμό μη συντακτικών σφαλμάτων με την μέθοδο εκτύπωσης την ενδιάμεσης πληροφορίας κατά την εκτέλεση του script. Επιπρόσθετα, γίνεται η δήλωση 4 άδειων λιστών (transmittedPackages, listOfNodes, listOfChannels, listOfNodesPerChannel) καθώς επίσης η δημιουργία και αρχικοποίηση 2 επιπλέων λιστών (bufferFails και queues). Συγκεκριμένα η λίστα transmittedPackages θα χρησιμοποιηθεί ως λίστα αποθήκευσης πακέτων που έχουν σταλεί με επιτυχία, η λίστα listOfNodes ως λίστα των διασυνδεδεμένων κόμβων, η λίστα listOfChannels ως λίστα των καναλιών και η λίστα listOfNodesPerChannel ως δομή δεδομένων που αποθηκεύει τον συνολικό αριθμό των καναλιών που χρησιμοποιεί κάθε κόμβος. Τελικά η λίστα bufferFails θα χρησιμοποιηθεί για να αυξάνει τους 8 αρχικοποιημένους μετρητές που περιλαμβάνει όταν αποτυγχάνουν τα πακέτα εξαιτίας του γεμάτου buffer των πακέτων Li και η λίστα queues για να αποθηκεύει σε μονοδιάστατους πίνακες την ουρά των πακέτων. Ο αριθμός των μονοδιάστατων πινάκων είναι ίσος με τον αριθμό των ζευγαριών transmitter και receiver.
 
    2. Ορισμός Κλάσης Packet

Το script συνεχίζει με τον ορισμό της κλάσης Packet και την δημιουργία του constructor της κλάσης για την θεσμοθέτηση 4 αντικειμένων (slotCreated, slotSent, transmitter, receiver). To αντικείμενο slotCreated χρησιμοποιείται ως βοηθητική μεταβλητή για τον προσδιορισμό του πότε δημιουργήθηκε το πακέτο, η slotSent μεταβλητή για το πότε στάλθηκε, η transmitter μεταβλητή για τον προσδιορισμό του transmitter του πακέτου και η μεταβλητή receiver για τον προσδιορισμό του πότε λήφθηκε το πακέτο. Επιπλέον η κλάση Packet ορίζει εσωτερικά της 3 μεθόδους α) την getDelay για τον υπολογισμό της καθυστέρησης αποστολής του πακέτου, β) την setSlotSent η οποία παίρνει ως παράμετρο τον χρονομετρητή για τις χρονοθυρίδες και ουσιαστικά καθορίζει πότε εστάλη το πακέτο και γ) την **str** η οποία χρησιμοποιείται για την εκτύπωση στον χρήστη όλων των αρχικοποιημένων μεταβλητών του κατασκευαστή της κλάσης και της καθυστέρησης του πακέτου σε ένα ενιαίο ενημερωτικό string.

    3. Ορισμός Βοηθητικών μεθόδων

Συνεχίζοντας, εκτός της κλάσης Packet, δημιουργούνται οι ακόλουθες 5 μέθοδοι. Η calcAverageDelay, η calcThroughPut, η setChannels, η schedule και η copyChannels, οι οποίες καλούνται επαναληπτικά μετέπειτα εντός της κύριας εφαρμογής του script. Η μέθοδος calcAverageDelay δέχεται ως παράμετρο μια λίστα από απεσταλμένα πακέτα και υπολογίζει και επιστρέφει την μέση τιμή καθυστέρησης της λίστας των πακέτων. Η calcThroughPut δεν δέχεται καμία παράμετρο, δηλώνει μια global λίστα την transmittedPackages για να αποθηκεύει τα πακέτα που έχουν φτάσει στον προορισμό τους και υπολογίζει και επιστρέφει τον ρυθμό διεκπεραίωσης των δεδομένων των πακέτων. Πρόσθετα η μέθοδος setChannels δεν λαμβάνει καμία παράμετρο, δηλώνει μια global λίστα την listOfNodesPerChannel για να είναι εφικτή η πρόσβαση στο περιεχόμενο της λίστας εκτός της μεθόδου. Η λίστα χρησιμοποιείται με σκοπό την αποθήκευση εντός της μεθόδου όλων των κόμβων που μπορούν να εξυπηρετούνται από ένα κανάλι. Στην προκειμένη περίπτωση όλοι οι κόμβοι είναι διασυνδεδεμένοι με WDM star και διαβιβάζουν προς όλα τα κανάλια που είναι πανομοιότυπα. Μεταξύ των άλλων μεθόδων, η schedule μέθοδος δέχεται δύο παραμέτρους την omega και a. H omega παράμετρος έχει τον πίνακας καναλιών και η a έχει την λίστα listOfNodesPerChannel που περιγράφηκε προηγουμένως. Η μέθοδος schedule υλοποιεί έναν αλγόριθμο 4 βημάτων που εκτελούνται επαναληπτικά με σκοπό την επιλογή καναλιών χωρίς διενέξεις και επιστρέφει τον πίνακα trans ο οποίος δημιουργείται κενός στην αρχή της μεθόδου. Οι επαναλήψεις του βρόχου στην μέθοδο συνεχίζουν όσο το μήκος του πίνακα καναλιών είναι μεγαλύτερος του μηδενός, δηλαδή όσο υπάρχουν κανάλια στην λίστα. Τα 4 βήματα που υλοποιούνται είναι α) η επιλογή ενός τυχαίου καναλιού με την random, β) η επιλογή ενός τυχαίου κόμβου i από το τυχαίο κανάλι, γ) ενημέρωση του πίνακα trans με το κανάλι που επιλέχθηκε στην θέση του αντίστοιχου κόμβου i του πίνακα και δ) αφαίρεση του κόμβου από την λίστα. Όταν η debug μεταβλητή είναι αληθής και ο μετρητής των χρονοθυρίδων είναι ίσος με 54 η μέθοδος εκτυπώνει τον πίνακα trans. Επιπροσθέτως υπάρχει και η βοηθητική μέθοδος copyChannels η οποία δεν λαμβάνει κάποια παράμετρο και έχει στόχο την αντιγραφή του πίνακα με τα κανάλια για την μετάδοση σε έναν άλλο μονοδιάστατο πίνακα τον result_list τον οποίο και επιστρέφει στο τέλος η function. Η μέθοδος copyChannels ορίζει την λίστα listOfChannels ως global για να υπάρχει πρόσβαση του περιεχομένου αυτής της λίστας εντός και εκτός της μεθόδου.

    4. Κύρια Εφαρμογή

Στο τέλος του Python script βρίσκεται η κύρια εφαρμογή και λογική επίλυσης του προβλήματος. Αρχικά, υλοποιείται ένας επαναληπτικός βρόχος για την επανάληψη των προσομοιώσεων (Runs) που έχουμε αναφέρει. Εντός του εξωτερικού βρόγχου, δημιουργείται ένας άλλος βρόχος στην γραμμή 106 με έναν επιπλέον εμφωλευμένο βρόχο για την δημιουργία μία άδειας λίστας για κάθε ζεύγος αποστολέα-παραλήπτη. Στην συνέχεια, στην μεταβλητή prob που έχουμε αναφέρει ανατίθεται η εξής πράξη 0.001+0.8\*(run / RUNS), όπου run είναι ο τρέχων αριθμός προσομοίωσης του εξωτερικού βρόγχου. Το εύρος πιθανοτήτων του prob μπορεί να είναι π.χ.: 0,1, 0,2, 0,3, 0,4 ανάλογα με το run και RUNS. Στην συνέχεια ακολουθεί o καθορισμός των λιστών listOfNodes και listOfChannels με τον συνολικό αριθμό των κόμβων και καναλιών αντίστοιχα. Έπειτα καλείται η μέθοδος setChannels χωρίς κάποια παράμετρο. Έπειτα, εντός του εξωτερικού βρόγχου επαναλαμβάνεται η διαδικασία (γραμμή 116) για διαδοχικές χρονικές περιόδους (NO_OF_SLOTS) και εσωτερικά αυτής δημιουργείται νέος εμφωλευμένος επαναληπτικός βρόχος για την δημιουργία πακέτων για κάθε κόμβο ξεχωριστά. Για τον σκοπό αυτό χρησιμοποιούμε ξανά την βιβλιοθήκη random στο μαθηματικό πεδίο ορισμού [0.1) και αν η τυχαία τιμή που έχει δημιουργηθεί είναι μικρότερη της τιμής της μεταβλητής prob τότε προχωράμε στην διαβίβαση του πακέτου. Πιο συγκεκριμένα, εξασφαλίζουμε με κατάλληλη συνθήκη ελέγχου ότι ο κόμβο-παραλήπτης δεν είναι ο ίδιος με τον κόμβος-αποστολέα και τότε δημιουργείται ένα πακέτο με χρόνο αναμονής έναρξης στην τρέχουσα χρονική περίοδο. Μετά, προσθέτουμε το πακέτο στην λίστα queues εφόσον η ουρά δεν είναι πλήρης. Μετέπειτα, καλούμε την βοηθητική μέθοδο η οποία όπως περιγράφηκε προηγουμένως εφαρμόζει έναν αλγόριθμο για τη διανομή καναλιών διεκπεραίωσης. Αν η debug μεταβλητή είναι αληθής εκτυπώνεται στον χρήστη η ουρά των κόμβων (queues). Στο τέλος του εξωτερικού βρόγχου φτιάχνουμε ένα επαναληπτικό βρόχο για την αποστολή πακέτων. Αν ο κόμβος στέλνει ένα πακέτο ενημερώνεται η queues αντίστοιχα. Επιπρόσθετα, γίνεται έλεγχος για να διαπιστώσουμε αν η queues του κόμβου i έχει κάποιο πακέτο για το συγκεκριμένο κανάλι στο οποίο έχει ανατεθεί η διεκπεραίωση. Αν δεν υπάρχει γίνεται αναμονή στην ουρά. Στο κανάλι k οι receivers 2k και 2k-1 ακούνε. Μετά την αποστολή ενος πακέτου αφαιρούμε το πακέτο από την ουρά, καλούμε την setSlotSent για να καθορίσουμε πότε στάλθηκε το πακέτο και το προσθέτουμε στην λίστα των transmittedPackages. Εφόσον η debug είναι αληθής και ο μετρητής των χρονοθυρίδων είναι ίσος με 54 εκτυπώνονται α) ο αριθμός του πακέτου, β) το κανάλι, γ) η βοηθητική μεταβλητή l που χρησιμοποιείται ως flag και δ) το πακέτο. Τελικά στην γραμμή 165 γίνεται ένας έλεγχος συνθήκης και εξετάζεται συγκεκριμένα αν είμαστε στην 1η προσομοίωση ώστε να εκτυπωθούν στον χρήστη πληροφορίες για τον αριθμό προσομοίωσης, την μέση τιμή καθυστέρησης, την πιθανότητα και τον ρυθμό διεκπεραίωσης. Επίσης, στην γραμμή 168 ελέγχουμε εάν η λογική μεταβλητή debug είναι αληθής ώστε αν εκτυπωθεί στον χρήστη σχετικό μήνυμα με τον αριθμό των πακέτων που δημιουργήθηκαν, τον αριθμό των πακέτων που διεκπεραιωθεί και από κάτω ένα μήνυμα που εκτυπώνει στην ίδια γραμμή κάθε μετρητή του bufferFails (που περιγράφηκε στην πρώτη σελίδα) με κενό ανάμεσά τους, και ένα μήνυμα RUN για να ενημερωθεί ο χρήστης ότι έχει τελειώσει η εκτέλεση του προγράμματος.




